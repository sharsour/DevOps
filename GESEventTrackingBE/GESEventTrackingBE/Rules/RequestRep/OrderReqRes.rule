/**
 * @description This rule sends the Response to the Order-Request sent by UI.
 * @author HYDPCM228839D
 */
rule Rules.RequestRep.OrderReqRes {
	attribute {
		priority = 5;
		forwardChain = true;
	}
	declare {
		Events.RequestReply.LgcyOrderRequest orderRequest;
		Concepts.ORDERS order;
	}
	when {
		order.LGCY_ORD_NUM==XPath.evalAsString("xpath://<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<xpath>\n    <expr>$orderRequest/payload/xsd2:OrderRequest/xsd2:OrderSearchRequest/xsd2:Lgcy_Order_id</expr>\n    <namespaces>\n        <namespace URI=\"http://www.w3.org/1999/XSL/Transform\" pfx=\"xsl\"/>\n        <namespace URI=\"http://www.pepsico.com/schemas/practice/Schemas/Schema.xsd5\" pfx=\"xsd2\"/>\n        <namespace URI=\"http://www.w3.org/2001/XMLSchema\" pfx=\"xsd\"/>\n    </namespaces>\n    <variables>\n        <variable>orderRequest</variable>\n    </variables>\n</xpath>");
	}
	then {
		System.debugOut("In OrderReqRes rule");
		
		//Logging.
		boolean cleFlag=System.getGlobalVariableAsBoolean("CLEparams/CLE_Flag",true);
		String gesAgentId=Engine.engineName();
		if(cleFlag)
		{
			Event.sendEvent(Event.createEvent("xslt://{{/Events/Common/LogEvent}}<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<xsl:stylesheet xmlns:xsd=\"http://www.w3.org/2001/XMLSchema\" xmlns:xsl=\"http://www.w3.org/1999/XSL/Transform\" xmlns:ns=\"http://www.pepsico.com/schemas/practice/Schemas/Schema.xsd5\" xmlns:ns1=\"http://www.PepsiCo.com/unique/default/namespace/CommonLE\" xmlns:ns2=\"http://www.pepsico.com/schemas/practice/Schemas/Schema.xsd3\" xmlns:ns3=\"http://www.pepsico.com/schemas/practice/Schemas/Schema.xsd\" version=\"1.0\" exclude-result-prefixes=\"ns2 ns1 xsl ns ns3 xsd\">\n    <xsl:output method=\"xml\"/>\n    <xsl:param name=\"globalVariables\"/>\n    <xsl:param name=\"gesAgentId\"/>\n    <xsl:param name=\"order\"/>\n    <xsl:param name=\"orderRequest\"/>\n    <xsl:template match=\"/\">\n        <createEvent>\n            <event>\n                <payload>\n                    <ns1:LogRequest>\n                        <ns1:Header>\n                            <ns1:ApplicationID>\n                                <xsl:value-of select=\"$globalVariables/CLEparams/CLE_Applicationid\"/>\n                            </ns1:ApplicationID>\n                            <ns1:ServiceName>\n                                <xsl:value-of select=\"$globalVariables/CLEparams/CLE_ServiceName\"/>\n                            </ns1:ServiceName>\n                            <ns1:ComponentName>\n                                <xsl:value-of select=\"$globalVariables/CLEparams/CLE_ComponentNames/RequestReply\"/>\n                            </ns1:ComponentName>\n                            <ns1:Hostname>\n                                <xsl:value-of select=\"$gesAgentId\"/>\n                            </ns1:Hostname>\n                            <ns1:Timestamp>\n                                <xsl:value-of select=\"current-dateTime()\"/>\n                            </ns1:Timestamp>\n                            <ns1:TransactionType>\n                                <xsl:value-of select=\"concat(&quot;LGCY ORDER SEARCH&quot;,$globalVariables/CLEparams/CLE_ComponentNames/RequestReply)\"/>\n                            </ns1:TransactionType>\n                            <xsl:if test=\"$order/PLANT_NUM\">\n                                <ns1:BusinessID>\n                                    <xsl:value-of select=\"$order/PLANT_NUM\"/>\n                                </ns1:BusinessID>\n                            </xsl:if>\n                        </ns1:Header>\n                        <ns1:Messages>\n                            <ns1:Name>\n                                <xsl:value-of select=\"&quot;LOG_MSG&quot;\"/>\n                            </ns1:Name>\n                            <ns1:Value>\n                                <xsl:value-of select=\"concat(&quot;Started sending response for Lgcy_Ord_Num&quot;,$orderRequest/payload/ns:OrderRequest/ns:OrderSearchRequest/ns:Lgcy_Order_id)\"/>\n                            </ns1:Value>\n                        </ns1:Messages>\n                        <ns1:Status>\n                            <xsl:value-of select=\"&quot;Start Log&quot;\"/>\n                        </ns1:Status>\n                        <ns1:TransactionBefore>\n                            <xsl:value-of select=\"string($orderRequest/payload)\"/>\n                        </ns1:TransactionBefore>\n                    </ns1:LogRequest>\n                </payload>\n            </event>\n        </createEvent>\n    </xsl:template>\n</xsl:stylesheet>"));
		}
		
		Events.RequestReply.LgcyOrderResponse orderReply=Event.createEvent("xslt://{{/Events/RequestReply/LgcyOrderResponse}}<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<xsl:stylesheet xmlns:xsd=\"http://www.w3.org/2001/XMLSchema\" xmlns:xsl=\"http://www.w3.org/1999/XSL/Transform\" xmlns:ns=\"http://www.pepsico.com/schemas/practice/Schemas/Schema.xsd5\" xmlns:tib=\"http://www.tibco.com/bw/xslt/custom-functions\" version=\"1.0\" exclude-result-prefixes=\"xsl ns xsd tib\">\n    <xsl:output method=\"xml\"/>\n    <xsl:param name=\"order\"/>\n    <xsl:template match=\"/\">\n        <createEvent>\n            <event>\n                <payload>\n                    <ns:OrderResponse>\n                        <ns:OrderSearchResponse>\n                            <xsl:if test=\"$order/LGCY_ORD_NUM\">\n                                <ns:Lgcy_Ord_Num>\n                                    <xsl:value-of select=\"$order/LGCY_ORD_NUM\"/>\n                                </ns:Lgcy_Ord_Num>\n                            </xsl:if>\n                            <xsl:if test=\"$order/SAP_ORD_NUM\">\n                                <ns:Sap_Ord_Num>\n                                    <xsl:value-of select=\"$order/SAP_ORD_NUM\"/>\n                                </ns:Sap_Ord_Num>\n                            </xsl:if>\n                            <xsl:if test=\"$order/ROUTE_NUM\">\n                                <ns:Route_Num>\n                                    <xsl:value-of select=\"$order/ROUTE_NUM\"/>\n                                </ns:Route_Num>\n                            </xsl:if>\n                            <xsl:if test=\"$order/CUST_NUM\">\n                                <ns:CustNum>\n                                    <xsl:value-of select=\"$order/CUST_NUM\"/>\n                                </ns:CustNum>\n                            </xsl:if>\n                            <xsl:if test=\"$order/PLANT_NUM\">\n                                <ns:Plant_Num>\n                                    <xsl:value-of select=\"$order/PLANT_NUM\"/>\n                                </ns:Plant_Num>\n                            </xsl:if>\n                            <xsl:if test=\"$order/PLANT_NAME\">\n                                <ns:Plant_Name>\n                                    <xsl:value-of select=\"$order/PLANT_NAME\"/>\n                                </ns:Plant_Name>\n                            </xsl:if>\n                            <xsl:if test=\"$order/DELIVERY_DATE\">\n                                <ns:Delivery_Date>\n                                    <xsl:value-of select=\"$order/DELIVERY_DATE\"/>\n                                </ns:Delivery_Date>\n                            </xsl:if>\n                            <xsl:if test=\"$order/SHIP_DATE\">\n                                <ns:Ship_Date>\n                                    <xsl:value-of select=\"$order/SHIP_DATE\"/>\n                                </ns:Ship_Date>\n                            </xsl:if>\n                            <xsl:if test=\"$order/ORD_TYPE\">\n                                <ns:Ord_Type>\n                                    <xsl:value-of select=\"$order/ORD_TYPE\"/>\n                                </ns:Ord_Type>\n                            </xsl:if>\n                            <xsl:if test=\"$order/TRIPID\">\n                                <ns:TripId>\n                                    <xsl:value-of select=\"$order/TRIPID\"/>\n                                </ns:TripId>\n                            </xsl:if>\n                            <xsl:if test=\"$order/TRIP_STATUS\">\n                                <ns:TripStatus>\n                                    <xsl:value-of select=\"$order/TRIP_STATUS\"/>\n                                </ns:TripStatus>\n                            </xsl:if>\n                            <xsl:if test=\"$order/CASES\">\n                                <ns:Cases>\n                                    <xsl:value-of select=\"$order/CASES\"/>\n                                </ns:Cases>\n                            </xsl:if>\n                            <xsl:if test=\"$order/ORD_STATUS\">\n                                <ns:OrderStatus>\n                                    <xsl:value-of select=\"$order/ORD_STATUS\"/>\n                                </ns:OrderStatus>\n                            </xsl:if>\n                            <xsl:if test=\"$order/SYSSTATE[SYSTEM=$order/LAST_KNOWN_SYS]/SYSTEM\">\n                                <ns:CurrentSystem>\n                                    <xsl:value-of select=\"$order/SYSSTATE[SYSTEM=$order/LAST_KNOWN_SYS]/SYSTEM\"/>\n                                </ns:CurrentSystem>\n                            </xsl:if>\n                            <ns:InDateTime>\n                                <xsl:value-of select=\"if(string-length($order/SYSSTATE[SYSTEM=$order/LAST_KNOWN_SYS]/IN_DATETIME)!=0)&#xA;then &#xA;$order/SYSSTATE[SYSTEM=$order/LAST_KNOWN_SYS]/IN_DATETIME&#xA;else&#xA;tib:format-dateTime(&quot;MM-dd-yyyy HH:mm:ss.SSS&quot;, tib:create-dateTime(1970,1, 1,0, 0,0))\"/>\n                            </ns:InDateTime>\n                            <ns:OutDateTime>\n                                <xsl:value-of select=\"if(string-length($order/SYSSTATE[SYSTEM=$order/LAST_KNOWN_SYS]/OUT_DATETIME)!=0)&#xA;then &#xA;$order/SYSSTATE[SYSTEM=$order/LAST_KNOWN_SYS]/OUT_DATETIME&#xA;else&#xA;tib:format-dateTime(&quot;MM-dd-yyyy HH:mm:ss.SSS&quot;, tib:create-dateTime(1970,1, 1,0, 0,0))\"/>\n                            </ns:OutDateTime>\n                        </ns:OrderSearchResponse>\n                    </ns:OrderResponse>\n                </payload>\n            </event>\n        </createEvent>\n    </xsl:template>\n</xsl:stylesheet>");
		
		Event.replyEvent(orderRequest,orderReply);
		
		//End Log.
		if(cleFlag)
		{
			Event.sendEvent(Event.createEvent("xslt://{{/Events/Common/LogEvent}}<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<xsl:stylesheet xmlns:xsd=\"http://www.w3.org/2001/XMLSchema\" xmlns:xsl=\"http://www.w3.org/1999/XSL/Transform\" xmlns:ns=\"http://www.pepsico.com/schemas/practice/Schemas/Schema.xsd5\" xmlns:ns1=\"http://www.PepsiCo.com/unique/default/namespace/CommonLE\" xmlns:ns2=\"http://www.pepsico.com/schemas/practice/Schemas/Schema.xsd3\" xmlns:ns3=\"http://www.pepsico.com/schemas/practice/Schemas/Schema.xsd\" version=\"1.0\" exclude-result-prefixes=\"ns2 ns1 xsl ns ns3 xsd\">\n    <xsl:output method=\"xml\"/>\n    <xsl:param name=\"globalVariables\"/>\n    <xsl:param name=\"gesAgentId\"/>\n    <xsl:param name=\"order\"/>\n    <xsl:param name=\"orderRequest\"/>\n    <xsl:param name=\"orderReply\"/>\n    <xsl:template match=\"/\">\n        <createEvent>\n            <event>\n                <payload>\n                    <ns1:LogRequest>\n                        <ns1:Header>\n                            <ns1:ApplicationID>\n                                <xsl:value-of select=\"$globalVariables/CLEparams/CLE_Applicationid\"/>\n                            </ns1:ApplicationID>\n                            <ns1:ServiceName>\n                                <xsl:value-of select=\"$globalVariables/CLEparams/CLE_ServiceName\"/>\n                            </ns1:ServiceName>\n                            <ns1:ComponentName>\n                                <xsl:value-of select=\"$globalVariables/CLEparams/CLE_ComponentNames/RequestReply\"/>\n                            </ns1:ComponentName>\n                            <ns1:Hostname>\n                                <xsl:value-of select=\"$gesAgentId\"/>\n                            </ns1:Hostname>\n                            <ns1:Timestamp>\n                                <xsl:value-of select=\"current-dateTime()\"/>\n                            </ns1:Timestamp>\n                            <ns1:TransactionType>\n                                <xsl:value-of select=\"concat(&quot;LGCY ORDER SEARCH&quot;,$globalVariables/CLEparams/CLE_ComponentNames/RequestReply)\"/>\n                            </ns1:TransactionType>\n                            <xsl:if test=\"$order/PLANT_NUM\">\n                                <ns1:BusinessID>\n                                    <xsl:value-of select=\"$order/PLANT_NUM\"/>\n                                </ns1:BusinessID>\n                            </xsl:if>\n                        </ns1:Header>\n                        <ns1:Messages>\n                            <ns1:Name>\n                                <xsl:value-of select=\"&quot;LOG_MSG&quot;\"/>\n                            </ns1:Name>\n                            <ns1:Value>\n                                <xsl:value-of select=\"concat(&quot;Completed sending response for Lgcy_Ord_Num&quot;,$orderRequest/payload/ns:OrderRequest/ns:OrderSearchRequest/ns:Lgcy_Order_id)\"/>\n                            </ns1:Value>\n                        </ns1:Messages>\n                        <ns1:Status>\n                            <xsl:value-of select=\"&quot;End Log&quot;\"/>\n                        </ns1:Status>\n                        <ns1:TransactionBefore>\n                            <xsl:value-of select=\"string($orderReply/payload)\"/>\n                        </ns1:TransactionBefore>\n                    </ns1:LogRequest>\n                </payload>\n            </event>\n        </createEvent>\n    </xsl:template>\n</xsl:stylesheet>"));
		}
		
	}
}